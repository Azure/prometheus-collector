scrape_configs:
- job_name: kubernetes-pods
  kubernetes_sd_configs:
  - role: pod
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: true
    source_labels:
    - __meta_kubernetes_pod_annotation_prometheus_io_scrape
  - action: replace
    regex: (.+)
    source_labels:
    - __meta_kubernetes_pod_annotation_prometheus_io_path
    target_label: __metrics_path__
  - action: replace
    regex: ([^:]+)(?::\d+)?;(\d+)
    replacement: $1:$2
    source_labels:
    - __address__
    - __meta_kubernetes_pod_annotation_prometheus_io_port
    target_label: __address__
  - action: labelmap
    regex: __meta_kubernetes_pod_label_(.+)
  - action: replace
    source_labels:
    - __meta_kubernetes_namespace
    target_label: kubernetes_namespace
  - action: replace
    source_labels:
    - __meta_kubernetes_pod_name
    target_label: kubernetes_pod_name
  - action: keep
    regex: .*|value
    source_labels:
    - __meta_kubernetes_namespace
  scrape_interval: 15s
- honor_labels: true
  job_name: acstor-metrics-exporter
  kubernetes_sd_configs:
  - namespaces:
      names:
      - acstor
      - kube-system
    role: pod
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|disk_read_operations_completed_total|disk_write_operations_completed_total|disk_read_operations_time_seconds_total|disk_write_operations_time_seconds_total|disk_read_bytes_total|disk_written_bytes_total|disk_reads_merged_total|disk_writes_merged_total|disk_io_now|disk_io_time_seconds_total|disk_io_time_weighted_seconds_total|disk_discard_operations_completed_total|disk_discards_merged_total|disk_discarded_sectors_total|disk_discard_operations_time_seconds_total|disk_flush_requests_total|disk_flush_requests_time_seconds_total|disk_errors_total|disk_readonly_errors_gauge|disk_readonly_status_gauge
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: acstor|kube-system
    source_labels:
    - __meta_kubernetes_namespace
  - action: keep
    regex: (metrics-exporter;monitor)|(storage-operator;node-agent)
    source_labels:
    - __meta_kubernetes_pod_label_app_kubernetes_io_name
    - __meta_kubernetes_pod_label_app_kubernetes_io_component
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  scheme: http
  scrape_interval: 15s
- job_name: kube-proxy
  kubernetes_sd_configs:
  - namespaces:
      names:
      - kube-system
    role: pod
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|kubeproxy_sync_proxy_rules_duration_seconds|kubeproxy_sync_proxy_rules_duration_seconds_bucket|kubeproxy_sync_proxy_rules_duration_seconds_sum|kubeproxy_sync_proxy_rules_duration_seconds_count|kubeproxy_network_programming_duration_seconds|kubeproxy_network_programming_duration_seconds_bucket|kubeproxy_network_programming_duration_seconds_sum|kubeproxy_network_programming_duration_seconds_count|rest_client_requests_total|rest_client_request_duration_seconds|rest_client_request_duration_seconds_bucket|rest_client_request_duration_seconds_sum|rest_client_request_duration_seconds_count|process_resident_memory_bytes|process_cpu_seconds_total|go_goroutines|kubernetes_build_info
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: kube-system/kube-proxy.+
    separator: /
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_pod_name
  - action: replace
    regex: (.+?)(\:\d+)?
    replacement: $$1:10249
    source_labels:
    - __address__
    target_label: __address__
  scrape_interval: 15s
- job_name: kube-state-metrics
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|kube_job_status_succeeded|kube_job_spec_completions|kube_daemonset_status_desired_number_scheduled|kube_daemonset_status_current_number_scheduled|kube_daemonset_status_number_misscheduled|kube_daemonset_status_number_ready|kube_deployment_status_replicas_ready|kube_pod_container_status_last_terminated_reason|kube_pod_container_status_waiting_reason|kube_pod_container_status_restarts_total|kube_node_status_allocatable|kube_pod_owner|kube_pod_container_resource_requests|kube_pod_status_phase|kube_pod_container_resource_limits|kube_replicaset_owner|kube_resourcequota|kube_namespace_status_phase|kube_node_status_capacity|kube_node_info|kube_pod_info|kube_deployment_spec_replicas|kube_deployment_status_replicas_available|kube_deployment_status_replicas_updated|kube_statefulset_status_replicas_ready|kube_statefulset_status_replicas|kube_statefulset_status_replicas_updated|kube_job_status_start_time|kube_job_status_active|kube_job_failed|kube_horizontalpodautoscaler_status_desired_replicas|kube_horizontalpodautoscaler_status_current_replicas|kube_horizontalpodautoscaler_spec_min_replicas|kube_horizontalpodautoscaler_spec_max_replicas|kubernetes_build_info|kube_node_status_condition|kube_node_spec_taint|kube_pod_container_info|kube_.*_labels|kube_.*_annotations|kube_service_info|kube_pod_container_status_running|kube_pod_container_status_waiting|kube_pod_container_status_terminated|kube_pod_container_state_started|kube_pod_created|kube_pod_start_time|kube_pod_init_container_info|kube_pod_init_container_status_terminated|kube_pod_init_container_status_terminated_reason|kube_pod_init_container_status_ready|kube_pod_init_container_resource_limits|kube_pod_init_container_status_running|kube_pod_init_container_status_waiting|kube_pod_init_container_status_restarts_total|kube_pod_container_status_ready|kube_pod_init_container_*|kube_pod_deletion_timestamp|kube_pod_status_reason|kube_pod_init_container_resource_requests
    source_labels:
    - __name__
  scrape_interval: 15s
  static_configs:
  - targets:
    - ama-metrics-ksm.kube-system.svc.cluster.local:8080
- honor_labels: true
  job_name: acstor-capacity-provisioner
  kubernetes_sd_configs:
  - namespaces:
      names:
      - acstor
    role: pod
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|storage_pool_ready_state|storage_pool_capacity_used_bytes|storage_pool_capacity_provisioned_bytes|storage_pool_snapshot_capacity_reserved_bytes
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: acstor
    source_labels:
    - __meta_kubernetes_namespace
  - action: keep
    regex: capacity-provisioner;capacity-provisoner
    source_labels:
    - __meta_kubernetes_pod_label_app_kubernetes_io_name
    - __meta_kubernetes_pod_label_app_kubernetes_io_component
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  scheme: http
  scrape_interval: 15s
- honor_labels: true
  job_name: local-csi-driver
  kubernetes_sd_configs:
  - namespaces:
      names:
      - kube-system
    role: pod
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|rpc.server.duration_milliseconds_bucket|rpc.server.duration_milliseconds_sum|rpc.server.duration_milliseconds_count|rpc_server_duration_milliseconds_bucket|rpc_server_duration_milliseconds_sum|rpc_server_duration_milliseconds_count
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: kube-system
    source_labels:
    - __meta_kubernetes_namespace
  - action: keep
    regex: csi-local-node
    source_labels:
    - __meta_kubernetes_pod_label_app_kubernetes_io_component
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  scheme: http
  scrape_interval: 15s
- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  job_name: kube-apiserver
  kubernetes_sd_configs:
  - namespaces:
      names:
      - default
    role: endpoints
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|apiserver_request_duration_seconds|apiserver_request_duration_seconds_bucket|apiserver_request_duration_seconds_sum|apiserver_request_duration_seconds_count|apiserver_request_total|workqueue_adds_total|workqueue_depth|workqueue_queue_duration_seconds|workqueue_queue_duration_seconds_bucket|workqueue_queue_duration_seconds_sum|workqueue_queue_duration_seconds_count|process_resident_memory_bytes|process_cpu_seconds_total|go_goroutines|kubernetes_build_info|apiserver_request_slo_duration_seconds_bucket|apiserver_request_slo_duration_seconds_sum|apiserver_request_slo_duration_seconds_count
    source_labels:
    - __name__
  relabel_configs:
  - action: keep
    regex: default;kubernetes;https
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_service_name
    - __meta_kubernetes_endpoint_port_name
  scheme: https
  scrape_interval: 15s
  tls_config:
    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    insecure_skip_verify: true
- job_name: kube-dns
  kubernetes_sd_configs:
  - namespaces:
      names:
      - kube-system
    role: pod
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metric_relabel_configs:
  - action: keep
    regex: test.*|test2|coredns_build_info|coredns_panics_total|coredns_dns_responses_total|coredns_forward_responses_total|coredns_dns_request_duration_seconds|coredns_dns_request_duration_seconds_bucket|coredns_dns_request_duration_seconds_sum|coredns_dns_request_duration_seconds_count|coredns_forward_request_duration_seconds|coredns_forward_request_duration_seconds_bucket|coredns_forward_request_duration_seconds_sum|coredns_forward_request_duration_seconds_count|coredns_dns_requests_total|coredns_forward_requests_total|coredns_cache_hits_total|coredns_cache_misses_total|coredns_cache_entries|coredns_plugin_enabled|coredns_dns_request_size_bytes|coredns_dns_request_size_bytes_bucket|coredns_dns_request_size_bytes_sum|coredns_dns_request_size_bytes_count|coredns_dns_response_size_bytes|coredns_dns_response_size_bytes_bucket|coredns_dns_response_size_bytes_sum|coredns_dns_response_size_bytes_count|coredns_dns_response_size_bytes_bucket|coredns_dns_response_size_bytes_sum|coredns_dns_response_size_bytes_count|process_resident_memory_bytes|process_cpu_seconds_total|go_goroutines|kubernetes_build_info
    source_labels:
    - __name__
  metrics_path: /metrics
  relabel_configs:
  - action: keep
    regex: kube-system/coredns.+
    separator: /
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_pod_name
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  - source_labels:
    - __meta_kubernetes_pod_name
    target_label: pod
  scheme: http
  scrape_interval: 15s

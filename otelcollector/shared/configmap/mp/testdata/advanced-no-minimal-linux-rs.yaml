scrape_configs:
- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  job_name: kube-apiserver
  kubernetes_sd_configs:
  - namespaces:
      names:
      - default
    role: endpoints
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  relabel_configs:
  - action: keep
    regex: default;kubernetes;https
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_service_name
    - __meta_kubernetes_endpoint_port_name
  scheme: https
  scrape_interval: 30s
  tls_config:
    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    insecure_skip_verify: true
- job_name: kube-state-metrics
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  scrape_interval: 30s
  static_configs:
  - targets:
    - ama-metrics-ksm.kube-system.svc.cluster.local:8080
- honor_labels: true
  job_name: acstor-capacity-provisioner
  kubernetes_sd_configs:
  - namespaces:
      names:
      - acstor
    role: pod
  relabel_configs:
  - action: keep
    regex: acstor
    source_labels:
    - __meta_kubernetes_namespace
  - action: keep
    regex: capacity-provisioner;capacity-provisoner
    source_labels:
    - __meta_kubernetes_pod_label_app_kubernetes_io_name
    - __meta_kubernetes_pod_label_app_kubernetes_io_component
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  scheme: http
  scrape_interval: 30s
- honor_labels: true
  job_name: acstor-metrics-exporter
  kubernetes_sd_configs:
  - namespaces:
      names:
      - acstor
    role: pod
  relabel_configs:
  - action: keep
    regex: acstor
    source_labels:
    - __meta_kubernetes_namespace
  - action: keep
    regex: metrics-exporter;monitor
    source_labels:
    - __meta_kubernetes_pod_label_app_kubernetes_io_name
    - __meta_kubernetes_pod_label_app_kubernetes_io_component
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  scheme: http
  scrape_interval: 30s
- job_name: kube-dns
  kubernetes_sd_configs:
  - namespaces:
      names:
      - kube-system
    role: pod
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  metrics_path: /metrics
  relabel_configs:
  - action: keep
    regex: kube-system/coredns.+
    separator: /
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_pod_name
  - action: keep
    regex: metrics
    source_labels:
    - __meta_kubernetes_pod_container_port_name
  - source_labels:
    - __meta_kubernetes_pod_name
    target_label: pod
  scheme: http
  scrape_interval: 30s
- job_name: kube-proxy
  kubernetes_sd_configs:
  - namespaces:
      names:
      - kube-system
    role: pod
  label_limit: 63
  label_name_length_limit: 511
  label_value_length_limit: 1023
  relabel_configs:
  - action: keep
    regex: kube-system/kube-proxy.+
    separator: /
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_pod_name
  - action: replace
    regex: (.+?)(\:\d+)?
    replacement: $$1:10249
    source_labels:
    - __address__
    target_label: __address__
  scrape_interval: 30s

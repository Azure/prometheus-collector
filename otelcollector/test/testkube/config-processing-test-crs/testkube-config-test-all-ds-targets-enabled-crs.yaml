apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: configprocessingcommon
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  config:
    AMW_QUERY_ENDPOINT:
      type: string
      default: ""
    AZURE_CLIENT_ID:
      type: string
      default: ""
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: "$BRANCH"
      paths:
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: AMW_QUERY_ENDPOINT
          value: "{{config.AMW_QUERY_ENDPOINT}}"
        - name: AZURE_CLIENT_ID
          value: "{{config.AZURE_CLIENT_ID}}"
      shell: |
        ginkgo run -r --label-filter "(config-processing-common, config-processing-common-with-config-maps)" ./configprocessing
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
---
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: alldstargetsenabled
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  config:
    AMW_QUERY_ENDPOINT:
      type: string
      default: ""
    AZURE_CLIENT_ID:
      type: string
      default: ""
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: "$BRANCH"
      paths:
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: AMW_QUERY_ENDPOINT
          value: "{{config.AMW_QUERY_ENDPOINT}}"
        - name: AZURE_CLIENT_ID
          value: "{{config.AZURE_CLIENT_ID}}"
      shell: |
        ginkgo run -r --label-filter "(config-processing-ds-targets-enabled)" ./configprocessing
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
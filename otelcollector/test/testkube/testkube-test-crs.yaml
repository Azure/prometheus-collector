apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: containerstatus
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: main
      paths: 
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: GOTOOLCHAIN
          value: "auto"
      shell: |
        ginkgo run -r --label-filter "!(arc-extension,linux-daemonset-custom-config,otlp)" ./containerstatus
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
---
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: livenessprobe
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: main
      paths: 
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: GOTOOLCHAIN
          value: "auto"
      shell: |
        ginkgo run -r --label-filter "!(arc-extension,linux-daemonset-custom-config,otlp)" ./livenessprobe
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
---
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: prometheusui
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: main
      paths: 
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: GOTOOLCHAIN
          value: "auto"
      shell: |
        ginkgo run -r --label-filter "!(arc-extension,linux-daemonset-custom-config,otlp)" ./prometheusui
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
---
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: operator
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: main
      paths: 
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: GOTOOLCHAIN
          value: "auto"
      shell: |
        ginkgo run -r --ldflags "-s -X github.com/prometheus-operator/prometheus-operator/pkg/apis/monitoring.GroupName=azmonitoring.coreos.com" ./operator
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64
---
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: querymetrics
  namespace: testkube
  labels:
    executor: ginkgo-executor
    test-type: ginkgo-test
spec:
  config:
    AMW_QUERY_ENDPOINT:
      type: string
      default: ""
    AZURE_CLIENT_ID:
      type: string
      default: ""
  content:
    git:
      uri: https://github.com/Azure/prometheus-collector
      revision: main
      paths: 
      - otelcollector/test/ginkgo-e2e
  steps:
    - name: Run test
      container:
        workingDir: /data/repo/otelcollector/test/ginkgo-e2e
        image: cerebro31/ginkgo-test:latest
        env:
        - name: AMW_QUERY_ENDPOINT
          value: "{{config.AMW_QUERY_ENDPOINT}}"
        - name: AZURE_CLIENT_ID
          value: "{{config.AZURE_CLIENT_ID}}"
        - name: GOTOOLCHAIN
          value: "auto"
      shell: |
        ginkgo run -r --label-filter "!(arc-extension,linux-daemonset-custom-config,otlp)" ./querymetrics
  pod:
    nodeSelector:
      kubernetes.io/os: linux
      kubernetes.io/arch: amd64

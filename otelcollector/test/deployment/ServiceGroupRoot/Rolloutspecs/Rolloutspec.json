{
  "$schema": "https://ev2schema.azure.net/schemas/2020-04-01/regionAgnosticRolloutSpecification.json",
  "contentVersion": "1.0.0", 
  "rolloutMetadata": {
    "name": "prometheus-collector-ginkgoe2e-tests-rollout",
    "serviceModelPath": "ServiceModels/ServiceModel.json",
    "ScopeBindingsPath": "ScopeBindings.json",
    "rolloutType": "Major",
    "configuration": {
      "serviceGroupScope": { "specPath": "config/$rolloutInfra().json" }
    },    
    "buildSource": {
      "parameters": {
        "versionFile": "buildver.txt"
      }
    }
  },
  "orchestratedSteps": [
    {
      "name": "UserAssignedIdentity",
      "targetType": "ServiceResourceDefinition",
      "targetName": "UserAssignedIdentity",
      "actions": [ "deploy" ]
    },
    {
       "name": "FetchMSIClientId",
       "targetType": "ServiceResourceDefinition",
       "targetName": "FetchMSIClientId",
       "actions": [ "deploy" ],
       "dependsOn": [
         "UserAssignedIdentity"
       ]
    },      
    {
      "name": "PromCollectorTestsShellExtension",
      "targetType": "ServiceResourceDefinition",
      "targetName": "PromCollectorTestsShellExtension",
      "actions": [ "shell/runPromCollectorTests" ],
      "dependsOn": [
        "UserAssignedIdentity",
        "FetchMSIClientId"
      ]
    }
  ]
}